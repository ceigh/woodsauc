let started=!1;try{const e=io("https://socket.donationalerts.ru:443",{reconnection:!1}),t=getCookie("token");t&&e.emit("add-user",{token:t,type:"minor"}),e.on("donation",function(e){if(started){let t=JSON.parse(e);if(1===t.alert_type){let e=t.message,n=t.amount,o=document.getElementsByClassName("name"),l=document.getElementsByClassName("cost"),i=!1;for(let t=0;t<Math.min(o.length,l.length);t++){let a=o[t].value,c=+l[t].value;if(a&&e.toLowerCase().includes(a.toLowerCase())){l[t].value=n+c,i=!0;break}}if(!i){let t=document.createElement("div");t.className="block",t.innerHTML=`<label>\n                       <input class="name" type="text" onkeyup="changeSize(this);createLink(this)"\n                         title="Фильм, игра, etc" value="${e}" autocomplete="off" placeholder="Позиция">\n                       <input class="cost" type="number" min="0" \n                         onkeyup="changeTitle(this)" onchange="sortCandidates()" placeholder="₽" title="Сумма" \n                         value="${n}" autocomplete="off">\n                     </label>\n                     <span>\n                     <a href="https://www.kinopoisk.ru" target="_blank" class="kp-link" \n                       title="Ссылка на кинопоиск"><img src="static/icons/round-video_library-24px.svg" \n                       alt="Иконка ссылки на кинопоиск"></a>\n                     <button type="button" class="btn" onclick="removeRow(this)" title="Удалить">\n                       <img src="static/icons/round-delete-24px.svg" alt="Иконка удаления">\n                     </button>\n                     </span>`,candidatesArea.insertBefore(t,candidatesArea.lastElementChild),sortCandidates();for(let e=0;e<o.length;e++)createLink(o[e])}}}})}catch(e){console.log("Нет подключения, автодобавление не будет работать.")}const defaultSize=16.2;let maxSize=defaultSize,styleForSize=document.createElement("style");function changeSize(e){let t,n=e.value.length-12,o=document.getElementsByClassName("name");n>0?t=16.2+1.2*n:1===o.length&&(maxSize=defaultSize,styleForSize.innerText=`.name{width:${defaultSize}vw}#add-btn{width:${defaultSize+10}vw}`),t&&t>maxSize&&(maxSize=t,styleForSize.innerText=`.name{width:${t}vw}#add-btn{width:${t+10}vw}`)}function returnWinner(){let e="Никто не ",t=null,n=document.getElementsByClassName("name"),o=document.getElementsByClassName("cost");for(let l=0;l<Math.min(n.length,o.length);l++){let i=n[l].value,a=+o[l].value;a>t&&(t=a,e=i||e)}return t&&(e=e[0].toUpperCase()+e.substring(1)),e}function startTimer(){started=!0,startBtn.onclick=void 0;const e=document.getElementById("timer");let t=e.innerHTML.split(":"),n=t[0],o=t[1],l=t[2];if(0==l){if(0==o){if(0==n){const t=document.querySelector("#modal"),n=document.querySelector("#modal-overlay");started=!1,e.classList.remove("danger"),n.onclick=function(){t.classList.toggle("closed"),n.classList.toggle("closed"),document.title="Аукцион β"};let o=returnWinner();return t.children[0].innerText=`${o} победил!`,t.classList.toggle("closed"),n.classList.toggle("closed"),document.title=`${o} победил!`,void(startBtn.onclick=function(){startTimer()})}o=59,--n<10&&(n=`0${n}`)}--o<30&&0==n?e.className="danger":e.classList.remove("danger"),o<10&&(o=`0${o}`);let t=returnWinner();t="Никто не "===t?"":` - ${t}`,document.title=`${n}:${o}${t}`,l=99}else l--;l<10&&(l=`0${l}`),e.innerHTML=`${n}:${o}:${l}`,setTimeout(startTimer,10)}styleForSize.appendChild(document.createTextNode(`.name{width:${defaultSize}vw}`)),document.head.appendChild(styleForSize);const startBtn=document.getElementById("start-btn"),resetBtn=document.getElementById("stop-btn"),plusBtn=document.getElementById("plus-btn"),plusTwoBtn=document.getElementById("plus-two-btn"),minusBtn=document.getElementById("minus-btn");function sortCandidates(){let e=[],t=document.getElementsByClassName("name"),n=document.getElementsByClassName("cost");for(let o=0;o<Math.min(t.length,n.length);o++){let l=t[o].value,i=+n[o].value,a=t[o].getAttribute("title"),c=n[o].getAttribute("title"),r=t[o].parentNode.parentNode.children[1].children[0].href;e.push({name:l,cost:i,titleName:a,titleCost:c,link:r})}e=e.sort(function(e,t){return e.cost-t.cost}).reverse();for(let o=0;o<Math.min(t.length,n.length);o++){let l=e[o].cost;n[o].value=0==l?"":l,t[o].value=e[o].name,t[o].setAttribute("title",e[o].titleName),n[o].setAttribute("title",e[o].titleCost),t[o].parentNode.parentNode.children[1].children[0].href=e[o].link}}function clearRow(){let e=document.getElementById("candidates-area"),t=e.children[0].children[0],n=e.children[0].children[1].children[0];t.children[0].value="",t.children[1].value="",t.children[0].setAttribute("title","Фильм, игра, etc"),t.children[1].setAttribute("title","Сумма"),n.href="https://www.kinopoisk.ru",changeSize(t.children[0])}function removeRow(e){e.parentNode.parentNode.parentNode.removeChild(e.parentNode.parentNode);let t=document.getElementsByClassName("name");1!==t.length||t[0].value||(maxSize=defaultSize,styleForSize.innerText=`.name{width:${defaultSize}vw}#add-btn{width:${defaultSize+10}vw}`)}function createLink(e){let t=e.value;t?(e.parentNode.parentNode.children[1].children[0].href=`https://www.kinopoisk.ru/s/type/all/find/${t}/`,e.setAttribute("title",t)):(e.parentNode.parentNode.children[1].children[0].href="https://www.kinopoisk.ru",e.setAttribute("title","Фильм, игра, etc"))}startBtn.onclick=function(){startTimer()},resetBtn.onclick=function(){timer.innerHTML="00:00:00"},plusBtn.onclick=function(){let e=timer.innerHTML.split(":"),t=e[0],n=e[1],o=e[2];++t<10&&(t=`0${t}`),timer.innerHTML=`${t}:${n}:${o}`},plusTwoBtn.onclick=function(){let e=timer.innerHTML.split(":"),t=e[0],n=e[1],o=e[2];t++,++t<10&&(t=`0${t}`),timer.innerHTML=`${t}:${n}:${o}`},minusBtn.onclick=function(){let e=timer.innerHTML.split(":"),t=e[0],n=e[1],o=e[2];--t<0?t="00":t<10&&(t=`0${t}`),timer.innerHTML=`${t}:${n}:${o}`};const addBtn=document.getElementById("add-btn");let candidatesArea=document.getElementById("candidates-area");function getCookie(e){let t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0}function setCookie(e,t,n){let o=(n=n||{}).expires;if("number"==typeof o&&o){const e=new Date;e.setTime(e.getTime()+1e3*o),o=n.expires=e}o&&o.toUTCString&&(n.expires=o.toUTCString());let l=`${e}=${t=encodeURIComponent(t)}`;for(const e in n){l+="; "+e;const t=n[e];!0!==t&&(l+="="+t)}document.cookie=l}function changeBG(e){let t=document.getElementsByTagName("body")[0];t.style.backgroundImage=e&&""!==e?`url(${e})`:"url('static/38263.jpg')"}function sheet(e){let t=document.createElement("style");return t.appendChild(document.createTextNode(e)),document.head.appendChild(t),t}addBtn.onclick=function(){let e=document.createElement("div");e.className="block",e.innerHTML='<label>\n                       <input class="name" type="text" onkeyup="changeSize(this);createLink(this)" \n                         title="Фильм, игра, etc" autocomplete="off" placeholder="Позиция">\n                       <input class="cost" type="number" min="0" \n                         onkeyup="changeTitle(this)" onchange="sortCandidates()" placeholder="₽" title="Сумма" autocomplete="off">\n                     </label>\n                     <span>\n                     <a href="https://www.kinopoisk.ru" target="_blank" class="kp-link" \n                       title="Ссылка на кинопоиск"><img src="static/icons/round-video_library-24px.svg" \n                       alt="Иконка ссылки на кинопоиск"></a>\n                     <button type="button" class="btn" onclick="removeRow(this)" title="Удалить">\n                       <img src="static/icons/round-delete-24px.svg" alt="Иконка удаления">\n                     </button>\n                    </span>',candidatesArea.insertBefore(e,candidatesArea.lastElementChild),sortCandidates()};const showSettingsBtn=document.getElementById("settings-icon").children[0],settingsWindow=document.getElementById("settings"),saveBGURLBtn=document.getElementById("save-bg-url-btn"),clearBGURLBtn=document.getElementById("clear-bg-url-btn"),bgURLInput=document.getElementById("bg-url"),colorExctractor=document.getElementById("color-extractor"),year=31622400;let styleElement,bgURL=getCookie("bg-url");showSettingsBtn.onclick=function(){settingsWindow.classList.toggle("closed")};let colorCookie=getCookie("accent");styleElement=sheet(colorCookie&&""!==colorCookie?`.name,.cost,#bg-url,.danger,#da-url{color:${colorCookie}!important}`:".name,.cost,#bg-url,.danger,#da-url{color:#f39727!important}"),saveBGURLBtn.onclick=function(){setCookie("bg-url",bgURLInput.value,{expires:year}),changeBG(getCookie("bg-url")),colorExctractor.setAttribute("src",`https://cors-anywhere.herokuapp.com/${bgURLInput.value}`),colorExctractor.addEventListener("load",function(){let e=new Vibrant(this).swatches().Vibrant.getHex();styleElement.innerText=`.name,.cost,#bg-url,.danger,#da-url{color:${e}!important}`,setCookie("accent",e,{expires:year})})},clearBGURLBtn.onclick=function(){bgURLInput.value="",saveBGURLBtn.click(),styleElement.innerText=".name,.cost,#bg-url,.danger,#da-url{color:#f39727!important}",setCookie("accent","",{expires:year})},changeBG(bgURL),bgURLInput.value=bgURL||"";const daURL=document.getElementById("da-url"),saveDAURLBtn=document.getElementById("save-da-url-btn"),clearDAURLBtn=document.getElementById("clear-da-url-btn"),tokenCookie=getCookie("token");function changeTitle(e){const t=e.value?`: ${e.value} ₽`:"";e.setAttribute("title",`Сумма${t}`)}daURL.value=tokenCookie||"",saveDAURLBtn.onclick=function(){let e=daURL.value;setCookie("token",e=e.substr(e.lastIndexOf("token=")+6),{expires:year}),alert("Токен сохранен"),location.reload()},clearDAURLBtn.onclick=function(){daURL.value="",setCookie("token","",{expires:year}),location.reload()},document.onkeydown=function(e){const t=document.querySelector("#modal"),n=document.querySelector("#modal-overlay");"Escape"!==e.key&&"Enter"!==e.key||(t.className="closed",n.className="closed")};const resetButton=document.getElementById("reset-icon");resetButton.onclick=function(){let e=document.getElementById("candidates-area");for(;e.children.length>2;)e.removeChild(e.children[e.children.length-2]);clearRow()};